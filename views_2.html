
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    

    <title>17. Views II: A default view for “talk” &mdash; Mastering Plone 1.1 documentation</title>

<meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;"/>


    
    <link rel="stylesheet" href="_static/rtd.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/searchtools.js"></script>
    <link rel="top" title="Mastering Plone 1.1 documentation" href="index.html" />
    <link rel="next" title="18. Views III: A Talk list" href="views_3.html" />
    <link rel="prev" title="16. Customizing existing templates" href="zpt_2.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="views_3.html" title="18. Views III: A Talk list"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="zpt_2.html" title="16. Customizing existing templates"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Mastering Plone 1.1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="views-ii-a-default-view-for-talk">
<h1>17. Views II: A default view for &#8220;talk&#8221;<a class="headerlink" href="#views-ii-a-default-view-for-talk" title="Permalink to this headline">¶</a></h1>
<p>Earlier we wrote a demo view which we also used to experiment with page templates.
Let us have a look at the zcml and the Page Template again.
I have extended the code just slightly.</p>
<p>ZCML</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;configure</span>
    <span class="na">xmlns=</span><span class="s">&quot;http://namespaces.zope.org/zope&quot;</span>
    <span class="na">xmlns:browser=</span><span class="s">&quot;http://namespaces.zope.org/browser&quot;</span>
    <span class="na">i18n_domain=</span><span class="s">&quot;ploneconf.talk&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;browser:page</span>
       <span class="na">name=</span><span class="s">&quot;demoview&quot;</span>
       <span class="na">for=</span><span class="s">&quot;*&quot;</span>
       <span class="na">layer=</span><span class="s">&quot;zope.interface.Interface&quot;</span>
       <span class="na">class=</span><span class="s">&quot;.views.DemoView&quot;</span>
       <span class="na">template=</span><span class="s">&quot;templates/demoview.pt&quot;</span>
       <span class="na">permission=</span><span class="s">&quot;zope2.View&quot;</span>
       <span class="nt">/&gt;</span>

<span class="nt">&lt;/configure&gt;</span>
</pre></div>
</div>
<p>Code</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">Products.Five.browser</span> <span class="kn">import</span> <span class="n">BrowserView</span>

<span class="k">class</span> <span class="nc">DemoView</span><span class="p">(</span><span class="n">BrowserView</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; This does nothing so far</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">context</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request</span> <span class="o">=</span> <span class="n">request</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Do stuff</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">DemoView</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__call__</span><span class="p">()</span>
</pre></div>
</div>
<p>Do you remember the term MultiAdapter? The browser page is just a multiadapter.
The zcml Statement browser:page registeres a multiadapter and adds additional things needed for a browser view.
An adapter adapts things, a multi adapter adapts multiple things.
When you enter an url, Zope tries to find an object for it. At the end, when zope does not find any more objects but there is still a path item left, or there are no more path items, Zope looks for an adapter that will reply to the request.
The Adapter adapts the request and the object that zope found with the URL.
The adapter class gets instanciated with the objects to be adapted, then it gets called.</p>
<p>The code above does the same thing that the standard implementation would do. It makes context and request available as variables on the object.
I have written down these methods because it important to understand some important concepts.
The init method gets called while Zope is still <em>trying</em> to find a view. At that phase, the security has not been resolved. Your code is not security checked. For historic reasons, many errors that happen in the init method can result in a page not found error instead of an exception.
Don&#8217;t do much at all in the init method.
Instead you have the guarantee the the call method is called before anything else (except the init method). It has the security checks in place and so on.
From a practical standpoint, consider the call method your init method, the biggest difference is that this method is suposed to return the html already.
Let your base class handle the html generation.</p>
<div class="section" id="grok">
<h2>Grok<a class="headerlink" href="#grok" title="Permalink to this headline">¶</a></h2>
<p>Now that we know how to read a zcml statement, we can continue with grok.
Grok is an alternative declaration language for declaring your components. It is compatible with the Zope Component Architecture, it used just an alternative syntax.
Instead of writing separate zcml files, you annotate your code and you create content conforming to specific file names so that they are automatically found.
There has been discussions whether grok should be used in the plone core. The plone community decided against it, because it increases the technology stack without adding functionality.
Some people are even against using it in Add Ons, because there would not be just one way to declare components, but two. Then there is onle last disadvantage, grok components cannot be overridden by z3c.jbot. I would not be surprised if this could be fixed though.
After all these negative things let us tell you why we still like it: We like to write as few lines of code and configuration as possible.</p>
<p>So, we will write our browser view as a grok view. From the component architecture side, nothing changes. We still need to write a multi adapter. All the details like which template to use or for which browser layer the view shall be used is declared with a single line annotation or deduced from file names.</p>
<p>Grok is not part of plone. We have to add it as a dependency to our egg.</p>
<p>open setup.py, extended it like this:</p>
<div class="highlight-python"><pre>...
    zip_safe=False,
    install_requires=[
        'setuptools',
        'plone.app.dexterity [grok]',
        # -*- Extra requirements: -*-
    ],
    extras_require={'test': ['plone.app.testing']},
    ...</pre>
</div>
<p>You need to run buildout now.</p>
<p>Grok nearly magicaly does find all its annotations. Since its not complete magic, you have to tell grok where to look for grok code. This requires a single line of zcml, that line ensures that your complete package is <cite>grokked</cite>.</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;configure</span>
    <span class="na">xmlns=</span><span class="s">&quot;http://namespaces.zope.org/zope&quot;</span>
    <span class="na">xmlns:five=</span><span class="s">&quot;http://namespaces.zope.org/five&quot;</span>
    <span class="na">xmlns:i18n=</span><span class="s">&quot;http://namespaces.zope.org/i18n&quot;</span>
    <span class="na">xmlns:genericsetup=</span><span class="s">&quot;http://namespaces.zope.org/genericsetup&quot;</span>
    <span class="na">xmlns:grok=</span><span class="s">&quot;http://namespaces.zope.org/grok&quot;</span>
    <span class="na">xmlns:plone=</span><span class="s">&quot;http://namespaces.plone.org/plone&quot;</span>
    <span class="na">i18n_domain=</span><span class="s">&quot;ploneconf.talk&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;includeDependencies</span> <span class="na">package=</span><span class="s">&quot;.&quot;</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;grok:grok</span> <span class="na">package=</span><span class="s">&quot;.&quot;</span> <span class="nt">/&gt;</span>
    ....
</pre></div>
</div>
<p>This new grok statement takes care of finding everything grok related.</p>
<p>Now finally on to the grok view in a new file views.py:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">five</span> <span class="kn">import</span> <span class="n">grok</span>
<span class="kn">from</span> <span class="nn">plone.directives</span> <span class="kn">import</span> <span class="n">dexterity</span>
<span class="kn">from</span> <span class="nn">zope.interface</span> <span class="kn">import</span> <span class="n">Interface</span>


<span class="k">class</span> <span class="nc">TalkView</span><span class="p">(</span><span class="n">dexterity</span><span class="o">.</span><span class="n">DisplayForm</span><span class="p">):</span>  <span class="c"># grok.View + dexterity information</span>
    <span class="n">grok</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="s">&quot;zope2.View&quot;</span><span class="p">)</span>
    <span class="n">grok</span><span class="o">.</span><span class="n">context</span><span class="p">(</span><span class="n">Interface</span><span class="p">)</span>
</pre></div>
</div>
<p>And the template. Important, the template must be in a subdirectory called <cite>views_templates</cite> and it must be named <cite>talkview.pt</cite>:</p>
<div class="highlight-python"><pre>&lt;html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
    lang="en"
    metal:use-macro="context/main_template/macros/master"
    i18n:domain="plonekonf.talk"&gt;
&lt;body&gt;
    &lt;metal:content-core fill-slot="content-core"&gt;
        &lt;p&gt;Suitable for &lt;em tal:replace="structure view/w/audience/render"&gt;&lt;/em&gt;
        &lt;/p&gt;

        &lt;div tal:content="structure view/w/details/render" /&gt;

        &lt;div&gt;Presenter:
            &lt;p&gt;
                &lt;strong tal:content="context/Creator"&gt;
                User
                &lt;/strong&gt;
            &lt;/p&gt;
        &lt;/div&gt;
    &lt;/metal:content-core&gt;
&lt;/body&gt;
&lt;/html&gt;</pre>
</div>
<p><em>Go through the code line by line</em></p>
<p>After a restart, we can test our view by going to a talk and add /talkview to the url.</p>
<p>If you are happy with it, you must tell Plone, that this view shall be the default view.
This is a configuration that you can change during runtime and is stored in the database, as such it is also managed by genericsetup profiles.</p>
<p>open profiles/default/types/talk.xml:</p>
<div class="highlight-python"><pre>...
&lt;property name="allow_discussion"&gt;False&lt;/property&gt;
&lt;property name="default_view"&gt;talkdefaultview&lt;/property&gt;
&lt;property name="view_methods"&gt;
    &lt;element value="talkdefaultview"/&gt;
&lt;/property&gt;
&lt;property name="default_view_fallback"&gt;False&lt;/property&gt;
...</pre>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<h3><a href="index.html">Table Of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">2. Installation &amp; Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="plone_training_config/instructions.html">3. Installing Plone for the Training</a></li>
<li class="toctree-l1"><a class="reference internal" href="anatomy.html">4. The Anatomy of Plone</a></li>
<li class="toctree-l1"><a class="reference internal" href="features.html">5. The Features of Plone</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuring_customizing.html">6. Configuring and Customising Plone through the web</a></li>
<li class="toctree-l1"><a class="reference internal" href="extending.html">7. Extending Plone</a></li>
<li class="toctree-l1"><a class="reference internal" href="addons.html">8. Extend Plone with Add-ons</a></li>
<li class="toctree-l1"><a class="reference internal" href="theming.html">9. Theming</a></li>
<li class="toctree-l1"><a class="reference internal" href="buildout_1.html">10. Buildout I</a></li>
<li class="toctree-l1"><a class="reference internal" href="ide.html">11. IDE&#8217;s and Editors</a></li>
<li class="toctree-l1"><a class="reference internal" href="eggs.html">12. Creating your own eggs to customize Plone</a></li>
<li class="toctree-l1"><a class="reference internal" href="dexterity.html">13. Creating content-types with Dexterity</a></li>
<li class="toctree-l1"><a class="reference internal" href="views_1.html">14. Views I</a></li>
<li class="toctree-l1"><a class="reference internal" href="zpt.html">15. Zope Page Templates</a></li>
<li class="toctree-l1"><a class="reference internal" href="zpt_2.html">16. Customizing existing templates</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">17. Views II: A default view for &#8220;talk&#8221;</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#grok">Grok</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="views_3.html">18. Views III: A Talk list</a></li>
<li class="toctree-l1"><a class="reference internal" href="custom_search.html">19. Custom search</a></li>
<li class="toctree-l1"><a class="reference internal" href="ressources.html">20. Ressources</a></li>
<li class="toctree-l1"><a class="reference internal" href="social_behavior.html">21. Social behavior</a></li>
<li class="toctree-l1"><a class="reference internal" href="viewlets.html">22. Writing Viewlets</a></li>
<li class="toctree-l1"><a class="reference internal" href="deployment_code.html">23. Deploying your code</a></li>
<li class="toctree-l1"><a class="reference internal" href="deployment_sites.html">24. Buildout II: Deploying your site</a></li>
<li class="toctree-l1"><a class="reference internal" href="future_of_plone.html">25. The Future of Plone</a></li>
<li class="toctree-l1"><a class="reference internal" href="optional.html">26. Optional</a></li>
</ul>

<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="views_3.html" title="18. Views III: A Talk list"
             >next</a></li>
        <li class="right" >
          <a href="zpt_2.html" title="16. Customizing existing templates"
             >previous</a> |</li>
        <li><a href="index.html">Mastering Plone 1.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
<div class="footer">
    &copy; Copyright 2013, Philip Bauer, Patrick Gerken.
  Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
  <br />Theme based on <a href="http://readthedocs.org/">Read The Docs</a>

</div>





  </body>
</html>